<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>(Reverse) Literate Programming on Jekyll/Github - Quentin Bonnard</title>
  <meta name="author" content="Quentin Bonnard">

  
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://quentin.bonnard.eu/blog/2011/12/18/Reverse_Literate_Programming_on_Jekyll-GitHub">
  <link href="/favicon.png" type="image/png" rel="icon">
  <link href="/atom.xml" rel="alternate" title="Quentin Bonnard" type="application/atom+xml">

  <link href="/assets/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="/assets/bootstrap/dist/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css">
<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">


  <script src="/javascripts/libs/jquery/jquery-2.0.3.min.js"></script>
  

</head>

  <body   >
    <div id="wrap">
      <div id="main" class="container">
        <div id="content">
          <div class="row">
  <nav class="sidebar col-md-3">
    <h3><a href="/">Quentin Bonnard</a></h3>
<section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title"><a href="/contact">About</a></h3>
  </div>
    <div id="about" class="hidden-xs hidden-sm list-group">
        <a
            target="_blank"
            class="list-group-item"
            href="https://www.linkedin.com/in/quentinbonnard">
            LinkedIn
        </a>
        <a
            target="_blank"
            class="list-group-item"
            href="https://github.com/qbonnard">
            GitHub
        </a>
        <a
            class="list-group-item "
            href="/contact">
            Contact
        </a>
  </div>
</section>
<section class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title"><a href="/portfolio">Portfolio</a></h3>
    </div>
    <div id="portfolio" class="hidden-xs hidden-sm list-group">
        <a
            class="list-group-item "
            href="/portfolio/chilitags">
            Chilitags
        </a>
        <a
            class="list-group-item "
            href="/portfolio/metroscope">
            Metroscope
        </a>
        <a
            class="list-group-item "
            href="/portfolio/holographic-showcases">
            Holographic Showcases
        </a>
        <a
            class="list-group-item "
            href="/portfolio/reflect-table">
            Reflect Table
        </a>
    </div>
</section>
<section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title"><a href="/blog/archives">Blog</a></h3>
  </div>
  
  <div id="recent_posts" class="hidden-xs hidden-sm list-group">
    
    <a class="list-group-item " href="/blog/2014/03/12/ar-2048-play-with-paper/">2048 in Augmented Reality</a>
    
    <a class="list-group-item " href="/blog/2014/03/03/Yes_my_Kindle_can_do_this_Flappy_bird_on_paper/">Yes, My Kindle Can Do This: Flappy Bird on Paper</a>
    
    <a class="list-group-item " href="/blog/2013/10/16/Using-OpenCV_s_test_framework_with_CMake/">Using OpenCV's Test Framework (With CMake)</a>
    
    <a class="list-group-item active" href="/blog/2011/12/18/Reverse_Literate_Programming_on_Jekyll-GitHub/">(Reverse) Literate Programming on Jekyll/Github</a>
    
    <a class="list-group-item " href="/blog/2011/10/25/The_answer_is_2011_the_question_can_be_brute_force/">The Answer Is 2011. The Question Can Be Brute Force.</a>
    
  </div>
</section>

  </nav>

  <div class="page-content col-md-9">
    <article class="hentry" role="article">
      
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2011-12-18T00:00:00+01:00" pubdate data-updated="true"></time>
        
      </p>
    
    
    <h1 class="entry-title">
        (Reverse) Literate Programming on Jekyll/Github
        
    </h1>
    
  </header>


<div class="entry-content clearfix"><p>In this post I show two ways to document a piece of code on <a href="https://github.com/mojombo/jekyll">Jekyll</a>, the static site generator powering <a href="http://pages.github.com/">GitHub Pages</a> (including this blog).</p>

<h1>The Story Behind the Story</h1>

<p>I tried to explain how this <a href="https://raw.github.com/qbonnard/qbonnard.github.com/master/_includes/2011-10-25/main.cpp">piece of code</a> found that <a href="/2011/10/25/The_answer_is_2011_the_question_can_be_brute_force.html"><code>(1+2)!! + 3!^4 - 5 = 2011</code></a>, but C++ is not famous for being concise and transparent. So I tried to give the general idea, and gave the full source in one block, but it was not very satisfying. Full of remorse, I&rsquo;m now writing this post about how I should have written the previous post, so I can sleep at night again.</p>

<p>I&rsquo;ll get some inspiration from <a href="http://en.wikipedia.org/wiki/Literate_programming">literate programming</a>, which I&rsquo;ll quickly present. Then I&rsquo;ll show how it could have been used on the previous post. This method won&rsquo;t work for any language, so I will present another one, based on a pending addition to Jekyll.</p>

<h1>Literate Programming</h1>

<p>Let me copy-paste the definition from the <a href="http://en.wikipedia.org/wiki/Literate_programming">Wikipedia article about literate programming</a> for you:</p>

<blockquote><p>The literate programming paradigm, as conceived by Knuth, represents a move away from writing programs in the manner and order imposed by the computer, and instead enables programmers to develop programs in the order demanded by the logic and flow of their thoughts.</p></blockquote>

<p>Basically, the documentation and the code is written in the same file, but in the order of the natural speech, not in the order expected by the compiler/interpreter, unlike javadoc-alike systems. A preprocessor will extract the code, and reassemble it in the order expected by the compiler/interpreter (hereafter: the processor).</p>

<p>In order to show to the processor that we are serious about not caring about him, literate programming can be done with latex, or a word processor. Yes, I spent an internship coding (<a href="http://research.microsoft.com/en-us/projects/specsharp/">Spec#</a>) within Word, and yes, I actually enjoyed it. More recently I discovered <a href="http://www.stat.uni-muenchen.de/~leisch/Sweave/">Sweave</a> which makes statistical exploration with R enjoyable (for a programmer).</p>

<p>Of course, the rule that any idea has already been implemented (better) and published also applies to <a href="https://github.com/mikaa123/lilp">literate programming with Markdown</a> (Markdown being the notation used to format this article). In this case, a script comments out all the text that is not marked as code. I guess the author calls this &ldquo;<em>lightweight</em> literate programming&rdquo; because the code still has to be written in the order expected by the processor.</p>

<h1>Manual Literate Programming On GitHub&rsquo;s Jekyll</h1>

<p>The idea here is to use the <code>#include</code> directive of the C/C++ preprocessor along with the <code>{% include %}</code> tag of the <a href="https://github.com/mojombo/jekyll/wiki/Liquid-Extensions">Liquid Extensions</a> of Jekyll to build the &ldquo;interconnected &lsquo;webs&rsquo; of macros&rdquo; of Knuth&rsquo;s vision of literate programming. The extraction step is manual: each macro will be written in a separate file.</p>

<p>For example, the core search function seems complicated at first:</p>

<figure class='code'><figcaption><span> (search.messy.cpp)</span> <a href='/_includes/2011-12-18/search.messy.cpp'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="k">template</span> <span class="o">&lt;</span><span class="kt">bool</span> <span class="n">ALL</span><span class="p">,</span> <span class="kt">int</span> <span class="n">VERBOSITY</span><span class="o">&gt;</span>
</span><span class='line'><span class="kt">void</span> <span class="n">search</span><span class="p">(</span><span class="n">Number</span> <span class="n">expectation</span><span class="p">,</span> <span class="k">const</span> <span class="n">Number</span> <span class="n">epsilon</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">EvaluationResult</span> <span class="n">result</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">long</span> <span class="n">tRemaingCandidates</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">[</span><span class="n">NBINOPERATIONS</span><span class="p">]</span>
</span><span class='line'>                    <span class="o">*</span><span class="n">pow</span><span class="p">(</span><span class="n">NBINOPERATIONTYPES</span><span class="p">,</span><span class="n">NBINOPERATIONS</span><span class="p">)</span>
</span><span class='line'>                    <span class="o">*</span><span class="n">pow</span><span class="p">(</span><span class="n">MAXFRAC</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">NBINOPERATIONS</span><span class="o">+</span><span class="n">NOPERANDS</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>                    <span class="o">*</span><span class="n">pow</span><span class="p">(</span><span class="n">MAXSQRT</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">NBINOPERATIONS</span><span class="o">+</span><span class="n">NOPERANDS</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">tRemaingCandidates</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; candidates&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class='line'>  <span class="k">do</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">result</span> <span class="o">=</span> <span class="n">evaluateCandidate</span><span class="p">(</span><span class="n">expectation</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">);</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="o">&amp;</span> <span class="n">VERBOSITY</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">decode</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;: &quot;</span><span class="p">;</span>
</span><span class='line'>          <span class="n">printCandidate</span><span class="p">();</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="o">--</span><span class="n">tRemaingCandidates</span><span class="p">;</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="n">ALL</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">tRemaingCandidates</span><span class="o">%</span><span class="mi">100000000</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>          <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">tRemaingCandidates</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; remaining candidates&quot;</span>
</span><span class='line'>                  <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">generateNextCandidate</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ALL</span> <span class="o">||</span> <span class="n">result</span> <span class="o">!=</span> <span class="n">CORRECT</span><span class="p">));</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Actually it is very simple if we extract the code related to printing progress:</p>

<figure class='code'><figcaption><span> (search.cpp)</span> <a href='/_includes/2011-12-18/search.cpp'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="cp">#include &quot;a-lot-of-code-before.inc&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">template</span> <span class="o">&lt;</span><span class="kt">bool</span> <span class="n">ALL</span><span class="p">,</span> <span class="kt">int</span> <span class="n">VERBOSITY</span><span class="o">&gt;</span>
</span><span class='line'><span class="kt">void</span> <span class="n">search</span><span class="p">(</span><span class="n">Number</span> <span class="n">expectation</span><span class="p">,</span> <span class="k">const</span> <span class="n">Number</span> <span class="n">epsilon</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">EvaluationResult</span> <span class="n">result</span><span class="p">;</span>
</span><span class='line'>  <span class="err">#</span><span class="n">include</span> <span class="s">&quot;print-candidate-total.inc&quot;</span>
</span><span class='line'>  <span class="k">do</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">result</span> <span class="o">=</span> <span class="n">evaluateCandidate</span><span class="p">(</span><span class="n">expectation</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">);</span>
</span><span class='line'>      <span class="err">#</span><span class="n">include</span> <span class="s">&quot;print-progress.inc&quot;</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">generateNextCandidate</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ALL</span> <span class="o">||</span> <span class="n">result</span> <span class="o">!=</span> <span class="n">CORRECT</span><span class="p">));</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &quot;a-lot-of-code-after.inc&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can detail separately the formula of the total of candidates, by showing only the content of <code>print-candidate-total.inc</code>:</p>

<figure class='code'><figcaption><span> (print-candidate-total.inc)</span> <a href='/_includes/2011-12-18/print-candidate-total.inc'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="kt">long</span> <span class="n">tRemaingCandidates</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">[</span><span class="n">NBINOPERATIONS</span><span class="p">]</span>
</span><span class='line'>                <span class="o">*</span><span class="n">pow</span><span class="p">(</span><span class="n">NBINOPERATIONTYPES</span><span class="p">,</span><span class="n">NBINOPERATIONS</span><span class="p">)</span>
</span><span class='line'>                <span class="o">*</span><span class="n">pow</span><span class="p">(</span><span class="n">MAXFRAC</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">NBINOPERATIONS</span><span class="o">+</span><span class="n">NOPERANDS</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>                <span class="o">*</span><span class="n">pow</span><span class="p">(</span><span class="n">MAXSQRT</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">NBINOPERATIONS</span><span class="o">+</span><span class="n">NOPERANDS</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">tRemaingCandidates</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; candidates&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>And we don&rsquo;t even need to show the content of <code>print-progress.inc</code>, because it is just uninteresting print instructions.</p>

<p>The Markdown document becomes something like:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>The core method is pretty simple; generate a solution and try the next:
</span><span class='line'>{% highlight cpp %}
</span><span class='line'>{% include 2011-12-18/search.cpp %}
</span><span class='line'>{% endhighlight %}
</span><span class='line'>
</span><span class='line'>Blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah,
</span><span class='line'>which gives us `(n-1)! * k^n * (s+1)^(n+n-1) * (f+1)^(n+n-1)` candidates: 
</span><span class='line'>{% highlight cpp %}
</span><span class='line'>{% include 2011-12-18/print-candidate-total.inc %}
</span><span class='line'>{% endhighlight %}</span></code></pre></td></tr></table></div></figure>


<p>This Markdown document is describing how to write a Markdown document describing other files by including them&hellip; Way too meta for me. If you too need to lower down the abstraction, you can have a look at the files I&rsquo;m talking about:</p>

<ul>
<li><a href="https://raw.github.com/qbonnard/qbonnard.github.com/master/_includes/2011-12-18/explanation.markdown">explanation.markdown</a> is the article describing how the program works</li>
<li><a href="https://raw.github.com/qbonnard/qbonnard.github.com/master/_includes/2011-12-18/search.cpp">search.cpp</a> and <a href="https://raw.github.com/qbonnard/qbonnard.github.com/master/_includes/2011-12-18/print-candidate-total.inc">print-candidate-total.inc</a> are pieces of code explained in the article.</li>
<li><a href="https://raw.github.com/qbonnard/qbonnard.github.com/master/_includes/2011-12-18/print-progress.inc">print-progress.inc</a>, <a href="https://raw.github.com/qbonnard/qbonnard.github.com/master/_includes/2011-12-18/a-lot-of-code-before.inc">a-lot-of-code-before.inc</a>, and <a href="https://raw.github.com/qbonnard/qbonnard.github.com/master/_includes/2011-12-18/a-lot-of-code-after.inc">a-lot-of-code-after.inc</a> is the rest of the code.</li>
</ul>


<p>The whole point of all this is that the code remains compilable (e.g. with <code>g++ -o search search.cpp</code>) without any transformation, just like the monolithic <a href="https://raw.github.com/qbonnard/qbonnard.github.com/master/_includes/2011-10-25/main.cpp">main.cpp</a>, but the explanation can be a lot more clear. It also means that there is no need to propagate modifications into the description should the code changes or vice versa.</p>

<h1>Reverse Literate Programming on Github&rsquo;s Jekyll</h1>

<p>Now the problem is that a lot of programming languages are too elegant to dirty their parsing hands with the <em>include</em> of a preprocessor. Of course, most languages allow the <em>import</em> of some notion of modules, but it&rsquo;s just the processor trying to dictate us the order in which to describe a program again.</p>

<p>Without heavy weaponry like a real literate programming preprocessor, we will have to call a truce. We&rsquo;ll still write the code in the order of the processor, but explain it in a human order. Anyway, no one actually believed that I wrote the code of previous section in the presented order.</p>

<p>Instead of writing a story that will be transformed into a program, we will write a program that will be reassembled into a story &ndash; hence the <em>reverse</em> literate programming. The feature needed here is to be able to extract parts of the source code. Jekyll&rsquo;s <code>{% include %}</code> can only extract the whole, but if this <a href="https://github.com/qbonnard/jekyll">patch</a> makes it through, we will be able to use blocks like:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>{% extract source.file %}
</span><span class='line'>  {% after //Some marker %}
</span><span class='line'>  {% before //Some other marker %}
</span><span class='line'>{% endextract %}</span></code></pre></td></tr></table></div></figure>


<p>Where:</p>

<ul>
<li><code>source.file</code> is the source to include (similarly to the <code>{% include %}</code> tag already in Jekyll),</li>
<li><code>after</code> is a tag to specify the line after which the content of the file should be included,</li>
<li><code>before</code> is a tag to specify the first line from which the content of the file will be ignored again.</li>
</ul>


<h2>Example</h2>

<p>For example, if I were to document the code of patch, instead of including the whole file containing:</p>

<figure class='code'><figcaption><span> (extract.rb)</span> <a href='/_includes/2011-12-18/extract.rb'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="k">module</span> <span class="nn">Jekyll</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">class</span> <span class="nc">ExtractBlock</span> <span class="o">&lt;</span> <span class="ss">Liquid</span><span class="p">:</span><span class="ss">:Block</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">unknown_tag</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">tokens</span><span class="p">)</span>
</span><span class='line'>      <span class="k">case</span> <span class="nb">name</span>
</span><span class='line'>      <span class="k">when</span> <span class="s2">&quot;after&quot;</span>
</span><span class='line'>        <span class="vi">@after</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">strip</span>
</span><span class='line'>      <span class="k">when</span> <span class="s2">&quot;before&quot;</span>
</span><span class='line'>        <span class="vi">@before</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">strip</span>
</span><span class='line'>      <span class="k">else</span>
</span><span class='line'>        <span class="k">super</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">tag_name</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">tokens</span><span class="p">)</span>
</span><span class='line'>      <span class="k">super</span>
</span><span class='line'>      <span class="vi">@file</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">strip</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</span><span class='line'>      <span class="n">includes_dir</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">registers</span><span class="o">[</span><span class="ss">:site</span><span class="o">].</span><span class="n">source</span><span class="p">,</span> <span class="s1">&#39;_includes&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="no">File</span><span class="o">.</span><span class="n">symlink?</span><span class="p">(</span><span class="n">includes_dir</span><span class="p">)</span>
</span><span class='line'>        <span class="k">return</span> <span class="s2">&quot;Includes directory &#39;</span><span class="si">#{</span><span class="n">includes_dir</span><span class="si">}</span><span class="s2">&#39; cannot be a symlink&quot;</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="vi">@file</span> <span class="o">!~</span> <span class="sr">/^[a-zA-Z0-9_\/\.-]+$/</span> <span class="o">||</span> <span class="vi">@file</span> <span class="o">=~</span> <span class="sr">/\.\//</span> <span class="o">||</span> <span class="vi">@file</span> <span class="o">=~</span> <span class="sr">/\/\./</span>
</span><span class='line'>        <span class="k">return</span> <span class="s2">&quot;Include file &#39;</span><span class="si">#{</span><span class="vi">@file</span><span class="si">}</span><span class="s2">&#39; contains invalid characters or sequences&quot;</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="no">Dir</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">includes_dir</span><span class="p">)</span> <span class="k">do</span>
</span><span class='line'>        <span class="n">choices</span> <span class="o">=</span> <span class="no">Dir</span><span class="o">[</span><span class="s1">&#39;**/*&#39;</span><span class="o">].</span><span class="n">reject</span> <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="no">File</span><span class="o">.</span><span class="n">symlink?</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">choices</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="vi">@file</span><span class="p">)</span>
</span><span class='line'>          <span class="n">source</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="vi">@file</span><span class="p">)</span>
</span><span class='line'>          <span class="c1">#Preceding code is the same as IncludeTag.render</span>
</span><span class='line'>          <span class="n">matchdata</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">match</span> <span class="sr">/</span><span class="si">#{</span><span class="no">Regexp</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="vi">@after</span><span class="p">)</span><span class="si">}</span><span class="sr">[^\n]*\n(.*)\n.*</span><span class="si">#{</span><span class="no">Regexp</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="vi">@before</span><span class="p">)</span><span class="si">}</span><span class="sr">/m</span>
</span><span class='line'>          <span class="k">if</span> <span class="n">matchdata</span><span class="o">.</span><span class="n">nil?</span> <span class="ow">or</span> <span class="n">matchdata</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;</span> <span class="mi">2</span>
</span><span class='line'>            <span class="k">return</span> <span class="s2">&quot;Unable to determine which lines of &#39;</span><span class="si">#{</span><span class="vi">@file</span><span class="si">}</span><span class="s2">&#39; &quot;</span><span class="o">+</span>
</span><span class='line'>            <span class="s2">&quot; are between &#39;</span><span class="si">#{</span><span class="vi">@after</span><span class="si">}</span><span class="s2">&#39; and &#39;</span><span class="si">#{</span><span class="vi">@before</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span class='line'>          <span class="k">end</span>
</span><span class='line'>          <span class="n">source</span> <span class="o">=</span> <span class="n">matchdata</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>
</span><span class='line'>          <span class="c1">#Following code is the same as IncludeTag.render</span>
</span><span class='line'>          <span class="n">partial</span> <span class="o">=</span> <span class="ss">Liquid</span><span class="p">:</span><span class="ss">:Template</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
</span><span class='line'>          <span class="n">context</span><span class="o">.</span><span class="n">stack</span> <span class="k">do</span>
</span><span class='line'>            <span class="n">partial</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</span><span class='line'>          <span class="k">end</span>
</span><span class='line'>        <span class="k">else</span>
</span><span class='line'>          <span class="s2">&quot;Included file &#39;</span><span class="si">#{</span><span class="vi">@file</span><span class="si">}</span><span class="s2">&#39; not found in _includes directory&quot;</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="ss">Liquid</span><span class="p">:</span><span class="ss">:Template</span><span class="o">.</span><span class="n">register_tag</span><span class="p">(</span><span class="s1">&#39;extract&#39;</span><span class="p">,</span> <span class="ss">Jekyll</span><span class="p">:</span><span class="ss">:ExtractBlock</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>I could simply write a markdown file containing:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Blablabla, I just copy-pasted `include.rb` and added this processing to the
</span><span class='line'>content read from the file:
</span><span class='line'>{% extract extract.rb %}
</span><span class='line'>  {% after #Preceding code is the same as IncludeTag.render %}
</span><span class='line'>  {% before #Following code is the same as IncludeTag.render %}
</span><span class='line'>{% endextract %}</span></code></pre></td></tr></table></div></figure>


<p>Which would give:</p>

<p>Blablabla, I just copy-pasted <code>include.rb</code> and added this processing to the
content read from the file:</p>

<figure class='code'><figcaption><span> (extract-core.rb)</span> <a href='/_includes/2011-12-18/extract-core.rb'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'>          <span class="n">matchdata</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">match</span> <span class="sr">/</span><span class="si">#{</span><span class="no">Regexp</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="vi">@after</span><span class="p">)</span><span class="si">}</span><span class="sr">[^\n]*\n(.*)\n.*</span><span class="si">#{</span><span class="no">Regexp</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="vi">@before</span><span class="p">)</span><span class="si">}</span><span class="sr">/m</span>
</span><span class='line'>          <span class="k">if</span> <span class="n">matchdata</span><span class="o">.</span><span class="n">nil?</span> <span class="ow">or</span> <span class="n">matchdata</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;</span> <span class="mi">2</span>
</span><span class='line'>            <span class="k">return</span> <span class="s2">&quot;Unable to determine which lines of &#39;</span><span class="si">#{</span><span class="vi">@file</span><span class="si">}</span><span class="s2">&#39; &quot;</span><span class="o">+</span>
</span><span class='line'>            <span class="s2">&quot; are between &#39;</span><span class="si">#{</span><span class="vi">@after</span><span class="si">}</span><span class="s2">&#39; and &#39;</span><span class="si">#{</span><span class="vi">@before</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span class='line'>          <span class="k">end</span>
</span><span class='line'>          <span class="n">source</span> <span class="o">=</span> <span class="n">matchdata</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Alternatives</h2>

<p>I can think of two other ways to specify the part of the file to be included. First, specifying the numbers of the first and last line to keep would be the easiest, but it would mean that the documentation has to be updated each time the file changes.</p>

<p>Second, the a <code>from</code>/<code>until</code> pair could specify border lines similarly to the <code>after</code>/<code>before</code> pair, except that the content would include these two lines. The problem here is that premature truncations could happen if we want to stop the inclusion on lines such as <code>}</code> or <code>end</code>.</p>

<p>In the end, the only assumption in the <code>after</code>/<code>before</code> pair is that one can add lines only for the sake of documentation, but I have not seen a programming langage which does not allow comments, so it is always possible to delimit regions.</p>
</div>


      <footer>
        <p class="meta text-muted">
          
  

<span class="glyphicon glyphicon-user"></span> <span class="byline author vcard">Posted by <span class="fn">Quentin Bonnard</span></span>

          












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2011-12-18T00:00:00+01:00" pubdate data-updated="true"></time>
          


        </p>
        
          <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://quentin.bonnard.eu/blog/2011/12/18/Reverse_Literate_Programming_on_Jekyll-GitHub/" data-via="" data-counturl="http://quentin.bonnard.eu/blog/2011/12/18/Reverse_Literate_Programming_on_Jekyll-GitHub/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

        
        
          <ul class="meta text-muted pager">
            
            <li class="previous"><a href="/blog/2011/10/25/The_answer_is_2011_the_question_can_be_brute_force/" title="Previous Post: The answer is 2011. The question can be brute force.">&laquo; The answer is 2011. The question can be brute force.</a></li>
            
            
            <li class="next"><a href="/blog/2013/10/16/Using-OpenCV_s_test_framework_with_CMake/" title="Next Post: Using OpenCV's test framework (with CMake)">Using OpenCV's test framework (with CMake) &raquo;</a></li>
            
          </ul>
        
      </footer>
    </article>
    
  </div>
</div>

        </div>
      </div>
    </div>
    <footer role="contentinfo"><div class="container">
    <p class="text-muted credits">
  Copyright &copy; 2010-2015 - Quentin Bonnard<br>
  <small>
      <span class="credit">Powered by <a target="_blank" href="http://octopress.org">Octopress</a></span>,
      <span class="credit">customized with <a target="_blank" href="https://github.com/kAworu/octostrap3">octostrap3</a></span>.
  </small>
</p>

</div>
</footer>
    <script src="/assets/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/javascripts/modernizr-2.0.js"></script>




<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-26532340-2']);
  _gaq.push(['_setDomainName', 'bonnard.eu']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>


  </body>
</html>
